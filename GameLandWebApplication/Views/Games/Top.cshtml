@model IEnumerable<GameLandWebApplication.Game>

@{
    ViewData["Title"] = "TopRatedGames";
}

<h1>TopRatedGames</h1>

<p>
    <a asp-action="Create">Create New</a>
</p> 
<style>
    .item{
    background:rgb(229, 223, 223);
    border-radius:10px;
    margin:20px 0 20px 0;
    padding: 20px;
    }
   
    </style>
@foreach (var item in Model.OrderByDescending(m => m.RatingByRedaction).ThenBy(m => m.GameName)) {
<div class="item">
    <a style="font-weight:700; font-size: 17px; text-decoration:none;color:black;" asp-action="GameInfo" asp-route-id="@item.GameId">@Html.DisplayFor(modelItem => item.GameName)</a>
    <div>
        <span>ReleaseDate: </span>        
        <span>
            @Html.DisplayFor(modelItem => item.GamesPlatforms.FirstOrDefault().ReleaseDate.Day)<span>.</span>@Html.DisplayFor(modelItem => item.GamesPlatforms.FirstOrDefault().ReleaseDate.Month)<span>.</span>@Html.DisplayFor(modelItem => item.GamesPlatforms.FirstOrDefault().ReleaseDate.Year)
        </span>    
    </div>
    <div style="display:flex; ">
        <span style="padding-right:5px;">Genres: </span>   
        @foreach (var genre in item.GamesGenres)
        {
            <span>
                @if (genre != item.GamesGenres.Last())
                {
                    @Html.DisplayFor(modelItem => genre.Genre.GenreName)<span style="padding-right:4px;">, </span>
                }
                else @Html.DisplayFor(modelItem => genre.Genre.GenreName)
            </span>
        }
    </div>
    <div style="display:flex; ">
        <span style="padding-right:5px;">Platforms: </span>
        @foreach (var gamePlatform in item.GamesPlatforms.OrderBy(m => m.ReleaseDate).ThenBy(m => m.PlatformId))
        {
            <span>
                @if (gamePlatform != item.GamesPlatforms.Last())
                {
                    @Html.DisplayFor(modelItem => gamePlatform.Platform.PlatformName)<span style="padding-right:4px;">, </span>
                }
                else @Html.DisplayFor(modelItem => gamePlatform.Platform.PlatformName)
            </span>
        }
    </div>
    <div style="margin-right:4px;">
        @Html.DisplayFor(modelItem => item.RatingByRedaction) redaction
    </div>
    <div style="margin-right:4px;">
        @Html.DisplayName(item.GamesUsers.Count == 0? "unrated": item.GamesUsers.Average(i => i.Rate).ToString())
            (@Html.DisplayName(item.GamesUsers.Count().ToString())) users
    </div>
    <div>
     <a asp-action="GameInfo" asp-route-id="@item.GameId"><img src="@Html.DisplayFor(modelItem => item.Photo)" style="max-height: 250px; width: auto;"/></a>
    </div>

    <div>
        <a asp-action="Edit" asp-route-id="@item.GameId">Edit</a> |
        <a asp-action="Delete" asp-route-id="@item.GameId">Delete</a>
    </div>
</div>
}
